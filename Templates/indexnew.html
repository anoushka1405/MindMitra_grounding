<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mann Mitra | Your Mental Health Companion</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <header>
    <div class="logo">
      <h2>Mann Mitra</h2>
    </div>
    <nav class="navbar">
      <a href="{{ url_for('home') }}">Home</a>
      <a href="{{ url_for('about') }}">About</a>
      <a href="{{ url_for('services') }}">Services</a>
      <a href="{{ url_for('contact') }}">Contact</a>
    </nav>
  </header>

  <section class="hero">
    <div class="hero-content" style="max-width: 1500px;">
      <div class="hero-text">
        <h1 style="font-size: 50px;">Welcome to Mann Mitra</h1>
        <h2>Your Friendly Mental Health Companion</h2>
        <p>
          Feeling stressed, anxious, or just need someone to talk to? Aasha is your private,
          24/7 AI-powered mental health assistant that offers comforting conversations whenever
          you need emotional support.
        </p>
        <button class="cta-btn" onclick="document.getElementById('chat').scrollIntoView({ behavior: 'smooth' });">Chat Now</button>
      </div>

      <div class="hero-board">
        <h3 style="text-align:center; padding-bottom:40px; font-size:22px">How are you feeling today?</h3>
        <div class="emotion-board">
          <div class="emotion-swatch" style="background-color: #6baffd" data-emotion="sadness">Sadness</div>
          <div class="emotion-swatch" style="background-color: #ffe96e" data-emotion="joy">Joy</div>
          <div class="emotion-swatch" style="background-color: #f36565" data-emotion="anger">Anger</div>
          <div class="emotion-swatch" style="background-color: #c36cfa" data-emotion="fear">Fear</div>
          <div class="emotion-swatch" style="background-color: #f8c66a" data-emotion="surprise">Surprise</div>
          <div class="emotion-swatch" style="background-color: #f64e86" data-emotion="love">Love</div>
          <div class="emotion-swatch" style="background-color: #ffe4c4" data-emotion="neutral">Neutral</div>
        </div>

        <div class="emotion-info">
          <h4 id="emotion-name"></h4>
          <p id="emotion-response"></p>
        </div>

        <div class="kindness-box" style="text-align: center; margin-top:6px;">
          <button id="kindness-btn">ðŸŒ¼ Need a little kindness?</button>
          <p id="kindness-quote"></p>
        </div>
      </div>
    </div>
  </section>

  <section id="chat" class="chat-container">
    <div class="chat-box" id="chat-box">
      <div class="chat-msg bot"><strong>Aasha:</strong> Hi, Iâ€™m Aasha. Whatâ€™s on your mind today?</div>
    </div>
    <div class="typing-indicator" id="typing-indicator" style="display: none;">
      Aasha is typing<span class="dot">.</span><span class="dot">.</span><span class="dot">.</span>
    </div>    
    <form class="chat-input" id="chat-form">
      <input type="text" id="user-input" placeholder="Type your message..." required />
      <button type="submit" id="send-button" title="Send Message">
        <i class="fas fa-paper-plane"></i>
      </button>
    </form>
  </section>

  <script>
    const chatForm = document.getElementById('chat-form');
    const chatBox = document.getElementById('chat-box');
    const userInput = document.getElementById('user-input');
    const typingIndicator = document.getElementById('typing-indicator');

    const emotionResponses = {
      joy: "I'm truly happy with you â€” moments like this are precious.",
      sadness: "I'm holding space for all the heaviness you're carrying right now.",
      anger: "Your frustration is valid and understandable.",
      fear: "Itâ€™s okay to feel scared â€” Iâ€™m here and youâ€™re not alone in this.",
      surprise: "That unexpected moment can really shake us.",
      love: "That warm feeling is a beautiful part of your day.",
      neutral: "Iâ€™m here, right with you â€” whatever youâ€™re feeling is okay."
    };

    document.querySelectorAll('.emotion-swatch').forEach(swatch => {
      swatch.addEventListener('click', () => {
        const emotion = swatch.getAttribute('data-emotion');
        document.getElementById('emotion-name').textContent = emotion.charAt(0).toUpperCase() + emotion.slice(1);
        document.getElementById('emotion-response').textContent = emotionResponses[emotion];
      });
    });

    document.getElementById("kindness-btn").addEventListener("click", () => {
      const quotes = [
        "Youâ€™re doing the best you can â€” and thatâ€™s something to honor.",
        "Itâ€™s okay to rest. You deserve kindness, even from yourself.",
        "Whatever youâ€™re feeling, itâ€™s human. And youâ€™re not alone.",
        "You donâ€™t have to be â€˜onâ€™ all the time. Just being is enough.",
        "Letâ€™s slow down. One deep breath, right here with me."
      ];
      const quote = quotes[Math.floor(Math.random() * quotes.length)];
      document.getElementById("kindness-quote").textContent = quote;
    });

    function appendMessage(sender, message) {
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('chat-msg');
      messageDiv.classList.add(sender === 'user' ? 'user' : 'bot');
      messageDiv.innerHTML = `<strong>${sender === 'user' ? 'You' : 'Aasha'}:</strong> ${message}`;
      chatBox.appendChild(messageDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function triggerCelebrationAnimation() {
      const colors = ['color1', 'color2', 'color3', 'color4'];
      for (let i = 0; i < 25; i++) {
        const balloon = document.createElement("div");
        balloon.classList.add("balloon");
        balloon.classList.add(colors[Math.floor(Math.random() * colors.length)]);
        balloon.style.left = Math.random() * 100 + "vw";
        balloon.style.animationDuration = 3 + Math.random() * 3 + "s";
        document.body.appendChild(balloon);
        setTimeout(() => balloon.remove(), 7000);
      }
    }

    function triggerConfetti() {
      confetti({ particleCount: 120, spread: 80, origin: { y: 0.6 } });
    }

    function triggerHearts() {
      for (let i = 0; i < 20; i++) {
        const heart = document.createElement("div");
        heart.classList.add("heart");
        heart.textContent = "â¤ï¸";
        heart.style.left = Math.random() * 100 + "vw";
        heart.style.animationDuration = 3 + Math.random() * 3 + "s";
        document.body.appendChild(heart);
        setTimeout(() => heart.remove(), 6000);
      }
    }

    chatForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const msg = userInput.value.trim();
      if (!msg) return;

      appendMessage('user', msg);
      userInput.value = '';
      typingIndicator.style.display = 'block';
      chatBox.scrollTop = chatBox.scrollHeight;

      try {
        const res = await fetch('/get', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams({ msg })
        });

        const data = await res.json();
        typingIndicator.style.display = 'none';
        appendMessage('aasha', data.reply);

        if (data.celebration_type === "balloons") {
          triggerCelebrationAnimation();
        } else if (data.celebration_type === "confetti") {
          triggerConfetti();
        } else if (data.celebration_type === "hearts") {
          triggerHearts();
        }

        updateChatboxEmotionColor(data.emotion || "neutral");

        if (data.exit_intent) {
          userInput.placeholder = "You can keep chatting if youâ€™d like.";
        }

      } catch (error) {
        typingIndicator.style.display = 'none';
        appendMessage('aasha', "Oops! Something went wrong.");
      }
    });

    function updateChatboxEmotionColor(emotion) {
      const emotionColors = {
        "sadness": "#6baffd",
        "joy": "#ffe96e",
        "anger": "#f36565",
        "fear": "#c36cfa",
        "surprise": "#f8c66a",
        "love": "#f64e86",
        "neutral": "#ffe4c4"
      };

      const color = emotionColors[emotion] || emotionColors["neutral"];
      document.getElementById("chat-box").style.backgroundColor = color;
    }
  </script>
</body>
</html>
